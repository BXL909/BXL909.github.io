
<!--UK FREE PARTY MAP by BXL909 -->
<!--BXL909.GITHUB.IO     -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Free Party Map 1988-94</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Slackey:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="manifest" href="site.webmanifest" />
    <style>
        html {
         height: 100%;
        }
        body {
         margin: 0;
         padding: 0;
         font-family: 'Space Mono', sans-serif;
         background: linear-gradient(45deg, #2a4a4a, #4a2a4a, #2a3a4a, #4a3a2a);
         background-size: 200% 200%;
         animation: gradientShift 5s ease infinite;
         color: #fff;
         display: flex;
         flex-direction: column;
         height: 100vh;
         overflow-x: hidden;
         position: relative;
         z-index: 0;
        }
        body::before {
         content: '';
         position: fixed;
         top: 0; left: 0;
         width: 100%;
         height: 95%;
         background: url('intropic1.png') center/cover no-repeat;
         opacity: 0.1; 
         pointer-events: none;
         z-index: -1;
         background-attachment: fixed;
        }
        @keyframes gradientShift {
         0% { background-position: 0% 50%; }
         50% { background-position: 100% 50%; }
         100% { background-position: 0% 50%; }
        }
        body a {
         color: #ff8a00;
         text-decoration: none;
         transition: color 0.3s;
         font-family: 'Space Mono', sans-serif;
        }
        header {
         background: rgba(0, 0, 0, 0.7);
         padding: 20px;
         text-align: left;
         border-bottom: 1px solid #000;
         position: relative;
         z-index: 1;
         flex-shrink: 0;
        }
        header h1 {
         margin: 0;
         font-family: 'Slackey', sans-serif;
         font-weight: 400;
         font-size: 2.8em;
         color: #666;
         text-transform: uppercase;
         letter-spacing: 0px;
         -webkit-text-stroke: 0.5px #fff;
         z-index: 10001;
        }
        @keyframes flicker {
         0% { opacity: 0.8; }
         50% { opacity: 1; }
         100% { opacity: 0.8; }
        }
        header p {
         margin: 0px 0 0;
         font-size: 1.1em;
         color: #ccc;
         font-family: 'Space Mono', sans-serif;
        }
        .container {
         display: flex;
         flex: 1;
         padding: 20px;
         gap: 20px;
         position: relative;
         z-index: 1;
         flex-direction: row;
         align-items: stretch;
        }
        .sidebar {
         min-width: 250px;
         max-width: 250px;
         background: rgba(0, 0, 0, 0.6);
         padding: 20px;
         border-image: linear-gradient(45deg, #00ffcc, #ff00ff) 1;
         border-radius: 7px;
         overflow-y: auto;
         backdrop-filter: blur(5px);
         position: relative;
         z-index: 1002;
         height: 100%;
         box-sizing: border-box;
        }
        .sidebar h2 {
         color: #666;
         margin: 0 0 5px;
         font-size: 1.1em;
         text-align: left;
         text-transform: uppercase;
         font-family: 'Slackey', sans-serif;
         font-weight: 400;
         display: inline;
        }
        .sidebar p {
         color: #ccc;
         line-height: 1.8;
         font-size: 0.8em;
         font-family: 'Space Mono', sans-serif;
         margin: 0 0 20px 0;
        }
        .sidebar ul {
         list-style: none;
         padding: 0;
         margin: 0 0 20px 0;
        }
        .sidebar li {
         padding: 2px 8px;
         cursor: pointer;
         color: #ccc;
         font-size: 0.8em;
         display: flex;
         align-items: center;
         transition: all 0.3s ease;
         position: relative;
         overflow: hidden;
         font-family: 'Space Mono', sans-serif;
        }
        .sidebar li img {
         width: 30px;
         height: 30px;
         margin-right: 8px;
         border: #000 0px solid;
         border-radius: 15px;
         transition: transform 0.5s ease;
        }
        .sidebar li:hover {
         background: rgba(255, 255, 255, 0.1);
         color: #fff;
        }
        .sidebar li:hover img {
         animation: singleRotate 0.5s ease-in-out;
        }
        .sidebar li.active img {
         animation: rotate 4s linear infinite;
        }
        .sidebar li.active {
         background: rgba(255, 255, 255, 0.15);
        }
        @keyframes singleRotate {
         0% { transform: rotate(0deg); }
         100% { transform: rotate(360deg); }
        }
        @keyframes rotate {
         100% { transform: rotate(360deg); }
        }
        .map-container {
         flex: 1;
         height: 100%;
         position: relative;
         overflow: hidden;
         border-radius: 7px;
         box-sizing: border-box;
        }
        #map {
         width: 100%;
         height: 100%;
         position: relative;
         border-radius: 7px;
         overflow: hidden;
        }
        .filter-overlay {
         position: absolute;
         bottom: 10px;
         left: 10px;
         background: rgba(0, 0, 0, 0.7);
         color: #ccc;
         padding: 4px 8px;
         border-radius: 7px;
         font-size: 0.85em;
         z-index: 1400;
         backdrop-filter: blur(5px);
         border: 1px solid #666;
         font-family: 'Space Mono', sans-serif;
         white-space: nowrap;
        }
        .map-overlay {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: radial-gradient(circle at center, rgba(0, 0, 0, 0) 0%, rgba(0, 63, 204, 0.3) 100%, rgba(255, 0, 255, 0.5) 0%);
         pointer-events: none;
         z-index: 1050 !important;
         border-radius: 7px;
        }
        .leaflet-container {
         z-index: 1000 !important;
        }
        .leaflet-tile-pane {
         z-index: 1100 !important;
        }
        .leaflet-marker-pane {
         z-index: 1200 !important;
        }
        .leaflet-overlay-pane {
         z-index: 1200 !important;
        }
        .leaflet-popup-pane {
         position: fixed !important; 
         z-index: 1500 !important; 
        }
        .leaflet-popup-content-wrapper {
         margin-top: 55px;
        }
        .leaflet-popup-pane a {
         color: #ff8a00;
         text-decoration: none;
         transition: color 0.3s;
         font-family: 'Space Mono', sans-serif;
        }
        .leaflet-popup-pane a:hover{
         color: #fff;
         text-decoration: none;
         transition: color 0.3s;
        }
        .leaflet-control-zoom {
         border: 0px !important;
        }
        .leaflet-control-pane {
         z-index: 1 !important;
        }
        .leaflet-control-zoom-in, .leaflet-control-zoom-out, .leaflet-control-layers {
         color: #fff !important;
         background: rgba(0, 0, 0, 0.7) !important;
         border-radius: 7px !important;
         margin-bottom: 2px !important;
         border: 0px !important;
        }
        .leaflet-control-zoom-in, .leaflet-control-zoom-out {
         height: 21px !important;
         width: 21px !important;
         font-size: 1.6em !important;
         display: flex !important;
         align-items: center !important;
         justify-content: center !important;
         line-height: 1 !important; 
        }

        .leaflet-top.leaflet-right {
         display: flex !important;
         flex-direction: row !important;
         align-items: flex-start !important;
         justify-content: flex-end !important;
         gap: 5px !important;
         margin: 10px 10px 0 0 !important;
         padding: 0 !important;
        }
        
        .leaflet-top.leaflet-right .leaflet-control {
         clear: none !important;
         float: none !important;
         margin: 0 !important; 
        }
        .info {
         padding: 10px 12px;
         font: 14px/16px 'Space Mono', sans-serif;
         background: rgba(0, 0, 0, 0.9);
         color: #ccc;
         border: 2px solid #ff00ff;
         border-radius: 7px;
        }
        .info h3 {
         font-family: 'Slackey', sans-serif;
         font-weight: bolder;
         font-size: 1.3em;
        }
        .info img {
         width: 50px;
         height: 50px;
         margin-right: 15px;
        }
        footer {
         background: rgba(0, 0, 0, 0.7);
         padding: 15px;
         text-align: center;
         border-top: 1px solid #000;
         position: relative;
         z-index: 0;
         flex-shrink: 0;
        }
        footer p {
         margin: 0;
         color: #ccc;
         font-size: 0.8em;
         font-family: 'Space Mono', sans-serif;
        }
        footer a {
         color: #ff8a00;
         text-decoration: none;
         transition: color 0.3s;
         font-family: 'Space Mono', sans-serif;
        }
        footer a:hover {
         color: #fff;
        }
        .flower-small {
         position: absolute;
         width: 50px;
         height: 50px;
         opacity: 0.10;
         pointer-events: none;
         z-index: 5;
         transition: transform 0.05s linear;
         will-change: transform;
         left: 0;
         top: 0;
        }
        .flower-medium {
         position: absolute;
         width: 75px;
         height: 75px;
         opacity: 0.10;
         pointer-events: none;
         z-index: 5;
         transition: transform 0.05s linear;
         will-change: transform;
         left: 0;
         top: 0;
        }
        .flower-large {
         position: absolute;
         width: 100px;
         height: 100px;
         opacity: 0.10;
         pointer-events: none;
         z-index: 5;
         transition: transform 0.05s linear;
         will-change: transform;
         left: 0;
         top: 0;
        }
        .rotating-flower {
         width: 100%;
         height: 100%;
         animation: rotateFlower 10s linear infinite;
        }
        .rotating-flower.reverse {
         animation: rotateFlowerReverse 10s linear infinite;
        }
        @keyframes rotateFlower {
         100% { transform: rotate(360deg); }
        }
        @keyframes rotateFlowerReverse {
         100% { transform: rotate(-360deg); }
        }
        .menu-toggle {
         height: 46px;
         display: none;
         position: fixed;
         left: 0;
         background: rgba(0, 0, 0, 0.7);
         color: #ccc;
         padding: 10px 5px;
         border-radius: 0 7px 7px 0;
         cursor: pointer;
         z-index: 1005;
         font-family: 'Space Mono', sans-serif;
         font-size: 1em;
         border: 1px solid #666;
         border-left: none;
         transition: background 0.3s ease;
        }
        .menu-toggle:hover {
         background: rgba(255, 255, 255, 0.2);
        }
        .close-btn {
         display: none;
         position: absolute;
         top: 10px;
         right: 10px;
         background: none;
         border: none;
         color: #ccc;
         font-size: 1.2em;
         cursor: pointer;
         font-family: 'Space Mono', sans-serif;
        }
        @media (max-width: 768px) {
            body {
             height: 95vh;
            }
            .container {
             flex-direction: column;
             padding: 10px;
             align-items: stretch;
            }
            .sidebar {
             position: fixed;
             left: -100%;
             height: auto;
             transition: left 0.3s ease;
             z-index: 10002;
             border-radius: 0 7px 7px 0;
             width: 50%;
             padding-top: 20px;
             height: 100vh;
            }
            .sidebar.open {
             left: 0;
            }
            .map-container {
             flex: 1;
             height: 100% !important;
             width: 100%;
            }
            .menu-toggle {
             display: block;
            }
            .close-btn {
             display: block;
            }
            header h1 {
             font-size: 1.7em !important;
            }
            header p {
             font-size: 1em;
            }
            .sidebar h2 {
             font-size: 1.0em;
            }
            .sidebar li {
             font-size: 0.8em;
            }
            .sidebar li img {
             width: 30px;
             height: 30px;
            }
            .filter-overlay {
             font-size: 0.6em;
             padding: 6px 10px;
             bottom: 5px;
             left: 5px;
            }
            footer {
             height: 40px;
            }
            footer p {
             font-size: 0.6em;
            }
        }
        @media (max-width: 480px) {
            .map-container {
             flex: 1;
             height: 100% !important;
            }
            header h1 {
             font-size: 1.4em;
            }
            header p {
             font-size: 0.8em;
            }
            .sidebar li img {
             width: 25px;
             height: 25px;
            }
            .filter-overlay {
             white-space: normal;
             text-align: center;
            }
        }
        .collapsible-header {
         display: inline-flex;
         align-items: baseline;
         margin-bottom: 0px;
        }
        .toggle-btn {
         background: none;
         border: none;
         color: #ccc;
         font-size: 1.0em;
         cursor: pointer;
         margin-left: 6px;
         padding: 0;
         margin-top: 1px;
         line-height: 1;
         vertical-align: baseline;
         transition: transform 0.3s ease;
        }
        .toggle-btn.collapsed {
         transform: rotate(-90deg);
        }
        .collapsible.collapsed li:not(.active) {
         display: none;
        }
        .collapsible li {
         transition: display 0.3s ease;
        }
        #map > div.leaflet-control-container > div.leaflet-bottom.leaflet-right > div
        {
         display: none;
        }
        .extra-container {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
    </style>
    <script>
        async function updateVisitorCounter() {
            const visitorCounter = document.getElementById('visitorCounter');
            try {
                const response = await fetch('https://api.counterapi.dev/v1/bxl909/free-party-map/up');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const result = await response.json();
                visitorCounter.textContent = result.count || '0'; 
            } catch (error) {
                console.error('CounterAPI error:', error.message);
                visitorCounter.textContent = 'Error';
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            updateVisitorCounter();
        });
    </script>
</head>
<body>
    <header>
        <h1>UK FREE PARTY MAP</h1>
        <p>EXPLORE THE FREE PARTY SCENE OF 1988-94</p>
        <div id="drifting-pink-flower-small" class="flower-small">
            <img src="flowerpink.png" alt="Drifting Pink Flower Small" class="rotating-flower">
        </div>
        <div id="drifting-pink-flower-medium" class="flower-medium">
            <img src="flowerpink.png" alt="Drifting Pink Flower Medium" class="rotating-flower reverse">
        </div>
        <div id="drifting-pink-flower-large" class="flower-large">
            <img src="flowerpink.png" alt="Drifting Pink Flower Large" class="rotating-flower">
        </div>
        <div id="drifting-green-flower-small" class="flower-small">
            <img src="flowergreen.png" alt="Drifting Green Flower Small" class="rotating-flower reverse">
        </div>
        <div id="drifting-green-flower-medium" class="flower-medium">
            <img src="flowergreen.png" alt="Drifting Green Flower Medium" class="rotating-flower">
        </div>
        <div id="drifting-green-flower-large" class="flower-large">
            <img src="flowergreen.png" alt="Drifting Green Flower Large" class="rotating-flower reverse">
        </div>
        <div id="drifting-yellow-flower-small" class="flower-small">
            <img src="floweryellow.png" alt="Drifting Yellow Flower Small" class="rotating-flower">
        </div>
        <div id="drifting-yellow-flower-medium" class="flower-medium">
            <img src="floweryellow.png" alt="Drifting Yellow Flower Medium" class="rotating-flower reverse">
        </div>
        <div id="drifting-yellow-flower-large" class="flower-large">
            <img src="floweryellow.png" alt="Drifting Yellow Flower Large" class="rotating-flower">
        </div>
        <div id="drifting-blue-flower-small" class="flower-small">
            <img src="flowerblue.png" alt="Drifting Blue Flower Small" class="rotating-flower reverse">
        </div>
        <div id="drifting-blue-flower-medium" class="flower-medium">
            <img src="flowerblue.png" alt="Drifting Blue Flower Medium" class="rotating-flower">
        </div>
        <div id="drifting-blue-flower-large" class="flower-large">
            <img src="flowerblue.png" alt="Drifting Blue Flower Large" class="rotating-flower reverse">
        </div>
        <div id="drifting-pill1-small" class="flower-small">
            <img src="pill1.png" alt="Drifting Pill1 Small" class="rotating-flower">
        </div>
        <div id="drifting-pill1-medium" class="flower-medium">
            <img src="pill1.png" alt="Drifting Pill1 Medium" class="rotating-flower reverse">
        </div>
        <div id="drifting-pill2-small" class="flower-small">
            <img src="pill2.png" alt="Drifting Pill2 Small" class="rotating-flower reverse">
        </div>
        <div id="drifting-pill2-medium" class="flower-medium">
            <img src="pill2.png" alt="Drifting Pill2 Medium" class="rotating-flower">
        </div>
        <div id="drifting-smiley-small" class="flower-small">
            <img src="smiley.png" alt="Drifting Smiley Small" class="rotating-flower reverse">
        </div>
        <div id="drifting-smiley-medium" class="flower-medium">
            <img src="smiley.png" alt="Drifting Smiley Medium" class="rotating-flower">
        </div>
        <div id="drifting-ohm-small" class="flower-small">
            <img src="ohm.png" alt="Drifting Ohm Small" class="rotating-flower reverse">
        </div>
        <div id="drifting-ohm-medium" class="flower-medium">
            <img src="ohm.png" alt="Drifting Ohm Medium" class="rotating-flower">
        </div>
    </header>
    <div class="container">
        <button class="menu-toggle">MENU</button>
        <div class="sidebar">
            <button class="close-btn">âœ•</button>
            <h2>About the Map</h2>
            <ul id="about-links" style="list-style: none; padding: 0; margin: 10px 0 20px 0;">
            <li data-modal="welcome-modal-2" class="about-link">
            <img src="flower.png" alt="Welcome Icon"> INTRODUCTION
            </li>
            <li data-modal="links-modal" class="about-link">
            <img src="flower.png" alt="Links Icon"> LINKS
            </li>
            </ul>
            <div class="collapsible-header">
                <h2>Free Parties</h2>
                <button class="toggle-btn" data-target="sound-systems">â–¼</button>
            </div>
            <ul id="sound-systems" class="collapsible">
            <li data-system="all" class="active"><img src="flower.png" alt="All Systems Icon">ALL FREE PARTIES (122)</li>
            <li data-system="Spiral Tribe"><img src="spiraltribe.png" alt="Spiral Tribe Logo">SPIRAL TRIBE (32)</li>
            <li data-system="DiY"><img src="diy.png" alt="DiY Logo">DiY (29)</li>
            <li data-system="Circus Warp"><img src="circuswarp.png" alt="Circus Warp Logo">CIRCUS WARP (25)</li>
            <li data-system="Free Party People"><img src="freepartypeople.png" alt="Free Party People Logo">FREE PARTY PEOPLE (9)</li>
            <li data-system="Sweat"><img src="sweat.png" alt="Sweat Logo">SWEAT (9)</li>
            <li data-system="Circus Normal"><img src="circusnormal.png" alt="Circus Normal Logo">CIRCUS NORMAL (6)</li>
            <li data-system="Street Level"><img src="streetlevel.png" alt="Street Level Logo">STREET LEVEL (5)</li>
            <li data-system="Desert Storm"><img src="desertstorm.png" alt="Desert Storm Logo">DESERT STORM (4)</li>
            <li data-system="Lazy House"><img src="lazyhouse.png" alt="Lazy House Logo">LAZY HOUSE (4)</li>
            <li data-system="PFP"><img src="pfp.png" alt="PFP Logo">PFP (4)</li>
            <li data-system="Spawny Posse"><img src="spawnyposse.png" alt="Spawny Posse Logo">SPAWNY POSSE (4)</li>
            <li data-system="Adrenelin"><img src="adrenelin.png" alt="Adrenelin Logo">ADRENELIN (3)</li>
            <li data-system="Circus Lunatek"><img src="circuslunatek.png" alt="Circus Lunatek Logo">CIRCUS LUNATEK (3)</li>
            <li data-system="Brainstorm"><img src="brainstorm.png" alt="Brainstorm Logo">BRAINSTORM (2)</li>
            <li data-system="Fear Teachers"><img src="fearteachers.png" alt="Fear Teachers Logo">FEAR TEACHERS (2)</li>
            <li data-system="Frequency Oblivion"><img src="frequencyoblivion.png" alt="Frequency Oblivion Logo">FREQUENCY OBLIVION (2)</li>
            <li data-system="Fun-de-mental"><img src="fundemental.png" alt="Fun-de-mental Logo">FUN-DE-MENTAL (2)</li>
            <li data-system="LSDiezel"><img src="lsdiezel.png" alt="LSDiezel Logo">LSDIEZEL (2)</li>
            <li data-system="Techno Travellers"><img src="technotravellers.png" alt="Techno Travellers Logo">TECHNO TRAVELLERS (2)</li>
            <li data-system="Tonka"><img src="tonka.png" alt="Tonka Logo">TONKA (2)</li>
            <li data-system="Armageddon"><img src="armageddon.png" alt="Armageddon Logo">ARMAGEDDON (1)</li>
            <li data-system="Club Dog"><img src="clubdog.png" alt="Club Dog Logo">CLUB DOG (1)</li>
            <li data-system="Conspiracy"><img src="conspiracy.png" alt="Conspiracy Logo">CONSPIRACY (1)</li>
            <li data-system="Dole House Crew"><img src="dolehousecrew.png" alt="Dole House Crew Logo">DOLE HOUSE CREW (1)</li>
            <li data-system="Exodus Collective"><img src="exoduscollective.png" alt="Exodus Collective Logo">EXODUS COLLECTIVE (1)</li>
            <li data-system="Eze Love"><img src="ezelove.png" alt="Eze Love Logo">EZE LOVE (1)</li>
            <li data-system="Hedonism"><img src="hedonism.png" alt="Hedonism Logo">HEDONISM (1)</li>
            <li data-system="Mutant Dance"><img src="mutantdance.png" alt="Mutant Dance Logo">MUTANT DANCE (1)</li>
            <li data-system="Safe & Sound"><img src="safeandsound.png" alt="Safe & Sound Logo">SAFE & SOUND (1)</li>
            <li data-system="Unite"><img src="unite.png" alt="Unite Logo">UNITE (1)</li>
            <li data-system="United Systems"><img src="unitedsystems.png" alt="United Systems Logo">UNITED SYSTEMS (1)</li>
            <li data-system="Virus"><img src="virus.png" alt="Virus Logo">VIRUS (1)</li>
            <li data-system="WDA"><img src="wda.png" alt="WDA Logo">WDA (1)</li>
            <li data-system="Unknown"><img src="unknown.png" alt="Unknown Logo">UNKNOWN (16)</li>
            </ul>
            <div class="collapsible-header">
                <h2>Years</h2>
                <button class="toggle-btn" data-target="year-filters">â–¼</button>
            </div>
            <ul id="year-filters" class="collapsible">
            <li data-year="all" class="active"><img src="flower.png" alt="All Years Icon">1988-94 (24)</li>
            <li data-year="1988"><img src="flower.png" alt="1988 Icon">1988 (1)</li>
            <li data-year="1989"><img src="flower.png" alt="1989 Icon">1989 (5)</li>
            <li data-year="1990"><img src="flower.png" alt="1990 Icon">1990 (7)</li>
            <li data-year="1991"><img src="flower.png" alt="1991 Icon">1991 (5)</li>
            <li data-year="1992"><img src="flower.png" alt="1992 Icon">1992 (3)</li>
            <li data-year="1993"><img src="flower.png" alt="1993 Icon">1993 (1)</li>
            <li data-year="1994"><img src="flower.png" alt="1994 Icon">1994 (2)</li>
            </ul>
        </div>
        <div id="sidebar-overlay" class="sidebar-overlay"></div>
        <div class="map-container">
        <div id="map"></div>
        <div class="filter-overlay" id="filter-overlay">
            Showing: <span id="selected-system">ALL FREE PARTIES</span> | Year: <span id="selected-year">88-94</span>
        </div>
        <div class="map-overlay"></div>
        </div>
    </div>
<footer>
    <p>MADE WITH ðŸ§¡ FOR THE FREE PARTY MOVEMENT | <a href="mailto:bxl909@pm.me" target="_blank">CONTACT</a> | <span id="visitorCounter">Loading...</span></p>
</footer>

<script src="parties.js"></script>

<script>
    function moveFlower(flowerId, initialXPercent, initialYPercent, size) {
        const flower = document.getElementById(flowerId);
        if (!flower) {
            console.error(`Error: #${flowerId} element not found in the DOM`);
            return;
        }

        const header = document.querySelector('header');
        if (!header) {
            console.error('Error: header element not found in the DOM');
            return;
        }

        function getHeaderBounds() {
            const rect = header.getBoundingClientRect();
            return {
                width: rect.width,
                height: rect.height,
                top: rect.top,
                left: rect.left
            };
        }

        let bounds = getHeaderBounds();
        let maxX = bounds.width - size;
        let maxY = bounds.height - size;
        let x = (bounds.width * initialXPercent) - (size / 2);
        let y = (bounds.height * initialYPercent) - (size / 2);
        let vx = (Math.random() - 0.5) * 50;
        let vy = (Math.random() - 0.5) * 50;
        let lastTime = performance.now();

        flower.style.transform = `translate(${x}px, ${y}px)`;

        function updatePosition(timestamp) {
            const deltaTime = (timestamp - lastTime) / 1000;
            lastTime = timestamp;

            x += vx * deltaTime;
            y += vy * deltaTime;

            if (x <= 0) { x = 0; vx = -vx; }
            else if (x >= maxX) { x = maxX; vx = -vx; }
            if (y <= 0) { y = 0; vy = -vy; }
            else if (y >= maxY) { y = maxY; vy = -vy; }

            if (x < -size || x > maxX + size || y < -size || y > maxY + size) {
                bounds = getHeaderBounds();
                maxX = bounds.width - size;
                maxY = bounds.height - size;
                x = (bounds.width * initialXPercent) - (size / 2);
                y = (bounds.height * initialYPercent) - (size / 2);
                vx = (Math.random() - 0.5) * 50;
                vy = (Math.random() - 0.5) * 50;
            }

            flower.style.transform = `translate(${x}px, ${y}px)`;
            requestAnimationFrame(updatePosition);
        }

        setTimeout(() => {requestAnimationFrame(updatePosition);}, 100);
    }

    // Initialize animations for all elements
    moveFlower('drifting-pink-flower-small', 0.2, 0.3, 50);
    moveFlower('drifting-pink-flower-medium', 0.5, 0.5, 75);
    moveFlower('drifting-pink-flower-large', 0.8, 0.7, 100);
    moveFlower('drifting-green-flower-small', 0.3, 0.8, 50);
    moveFlower('drifting-green-flower-medium', 0.7, 0.2, 75);
    moveFlower('drifting-green-flower-large', 0.4, 0.6, 100);
    moveFlower('drifting-yellow-flower-small', 0.15, 0.45, 50);
    moveFlower('drifting-yellow-flower-medium', 0.65, 0.35, 75);
    moveFlower('drifting-yellow-flower-large', 0.25, 0.65, 100);
    moveFlower('drifting-blue-flower-small', 0.85, 0.25, 50);
    moveFlower('drifting-blue-flower-medium', 0.35, 0.15, 75);
    moveFlower('drifting-blue-flower-large', 0.55, 0.75, 100);
    moveFlower('drifting-pill1-small', 0.1, 0.2, 50);
    moveFlower('drifting-pill1-medium', 0.9, 0.4, 75);
    moveFlower('drifting-pill2-small', 0.3, 0.1, 50);
    moveFlower('drifting-pill2-medium', 0.7, 0.8, 75);
    moveFlower('drifting-smiley-small', 0.5, 0.1, 50);
    moveFlower('drifting-smiley-medium', 0.6, 0.8, 75);
    moveFlower('drifting-ohm-small', 0.9, 0.4, 50);
    moveFlower('drifting-ohm-medium', 0.2, 0.6, 75);

    // Update boundaries on window resize
    window.addEventListener('resize', () => {
        moveFlower('drifting-pink-flower-small', 0.2, 0.3, 50);
        moveFlower('drifting-pink-flower-medium', 0.5, 0.5, 75);
        moveFlower('drifting-pink-flower-large', 0.8, 0.7, 100);
        moveFlower('drifting-green-flower-small', 0.3, 0.8, 50);
        moveFlower('drifting-green-flower-medium', 0.7, 0.2, 75);
        moveFlower('drifting-green-flower-large', 0.4, 0.6, 100);
        moveFlower('drifting-yellow-flower-small', 0.15, 0.45, 50);
        moveFlower('drifting-yellow-flower-medium', 0.65, 0.35, 75);
        moveFlower('drifting-yellow-flower-large', 0.25, 0.65, 100);
        moveFlower('drifting-blue-flower-small', 0.85, 0.25, 50);
        moveFlower('drifting-blue-flower-medium', 0.35, 0.15, 75);
        moveFlower('drifting-blue-flower-large', 0.55, 0.75, 100);
        moveFlower('drifting-pill1-small', 0.1, 0.2, 50);
        moveFlower('drifting-pill1-medium', 0.9, 0.4, 75);
        moveFlower('drifting-pill2-small', 0.3, 0.1, 50);
        moveFlower('drifting-pill2-medium', 0.7, 0.8, 75);
        moveFlower('drifting-smiley-small', 0.5, 0.1, 50);
        moveFlower('drifting-smiley-medium', 0.6, 0.8, 75);
        moveFlower('drifting-ohm-small', 0.9, 0.4, 50);
        moveFlower('drifting-ohm-medium', 0.2, 0.6, 75);
    });

    function updateSidebarPosition() {
        if (window.innerWidth <= 768) {
            const header = document.querySelector('header');
            const sidebar = document.querySelector('.sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            const headerHeight = header.getBoundingClientRect().height;
            const menuOffset = 10; 
            const mapTop = headerHeight + 10; 

            sidebar.style.top = `0px`;
            sidebar.style.height = `100vh`;

            menuToggle.style.top = `${mapTop + menuOffset}px`;
        } else {
            const sidebar = document.querySelector('.sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            sidebar.style.top = ''; 
            sidebar.style.height = '';
            menuToggle.style.top = '';
        }
    }

    window.addEventListener('resize', () => {
        updateSidebarPosition();
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        if (window.innerWidth > 768 && sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
            if (overlay) overlay.classList.remove('active');
            if (map) map.invalidateSize();
        }
    });

    var map = L.map('map', {
        minZoom: 1,
        layers: []
    });

    map.zoomControl.setPosition('topright');

    setTimeout(() => {
        map.invalidateSize();
    }, 0);

    var customIcon = L.icon({
        iconUrl: 'placemark.png',
        iconSize: [15, 15],
        iconAnchor: [7, 7],
        popupAnchor: [0, -10]
    });

    var esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
        zIndex: 1100
    });

    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        zIndex: 1100
    });

    var stadia = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a>',
        zIndex: 1100
    });

    var cartoPositron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        zIndex: 1100
    });

    var openTopo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (CC-BY-SA)',
        zIndex: 1100
    });

    var stamenToner = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}{r}.png', {
        attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        zIndex: 1100
    });

    var esriLabels = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri',
        zIndex: 1150,
        opacity: 1.0
    });

    var baseLayers = {
        "Satellite": esri,
        "Street Map": osm
    };

    var overlays = {
        "Show Placenames": esriLabels
    };

    var layerControl = L.control.layers(baseLayers, overlays).addTo(map);

    function updateLayerControl() {
        var activeBaseLayer = map.hasLayer(esri) ? esri : osm;
        layerControl.remove();

        var currentOverlays = map.hasLayer(esri) ? overlays : {};
        layerControl = L.control.layers(baseLayers, currentOverlays).addTo(map);

        if (map.hasLayer(esri) && !map.hasLayer(esriLabels)) {
            esriLabels.addTo(map);
        }
        if (!map.hasLayer(esri) && map.hasLayer(esriLabels)) {
            map.removeLayer(esriLabels);
        }
    }

    map.on('baselayerchange', function(event) {
        updateLayerControl();
    });

    map.on('overlayadd', function(event) {
        if (event.name === "Show Placenames" && !map.hasLayer(esri)) {
            map.removeLayer(esriLabels);
        }
    });

    esri.addTo(map);
    esriLabels.addTo(map);
    updateLayerControl();

    function extractYear(dateStr) {
        var yearMatch = dateStr.match(/\b(\d{4})\b/);
        return yearMatch ? yearMatch[0] : "1990s";
    }

    var markers = [];
    var markerGroup = L.layerGroup().addTo(map);

    parties.forEach(function(p, index) {
        var marker = L.marker([p[0], p[1]], {
            icon: customIcon,
            systems: p[4].map(s => s.name),
            year: extractYear(p[3])
        });
        markers.push(marker);
        markerGroup.addLayer(marker);

        marker.on('click', function() {
            document.getElementById('party-title').innerHTML = p[2] + ' (' + p[3] + ')';

            var sysHtml = p[4].map(function(s) {
                var logo = s.logo ? '<img src="' + s.logo + '" alt="' + s.name + ' Logo" style="width:30px;height:30px;margin-right:10px;border-radius:15px;vertical-align:middle;">' : '';
                return logo + s.name;
            }).join('<br>');
            document.getElementById('party-systems').innerHTML = '<strong>Sound Systems:</strong><br>' + sysHtml;

            document.getElementById('party-notes').innerHTML = '<strong>Notes:</strong><br>' + p[5];

            var linksHtml = p[6].map(function(l) { return '<a href="' + l.url + '" target="_blank">' + l.text + '</a>'; }).join('<br>');
            document.getElementById('party-links').innerHTML = '<strong>Read more:</strong><br>' + linksHtml;

            var modal = document.getElementById('party-modal');
            var overlay = document.getElementById('party-modal-overlay');
            modal.classList.add('active');
            overlay.classList.add('active');
        });
    });

    function updateMapBounds(visibleMarkers) {
        map.invalidateSize();
        map.setMinZoom(1);

        if (visibleMarkers.length === 0) {
            map.setView([54.5, -2.5], 6);
            return;
        }

        if (visibleMarkers.length === 1) {
            const latLng = visibleMarkers[0].getLatLng();
            map.setView(latLng, 15);
            map.setMinZoom(10);
            setTimeout(() => {
                map.invalidateSize();
                map.setView(latLng, 15);
        }, 100);
        return;
    }

    var visibleGroup = new L.featureGroup(visibleMarkers);
    var bounds = visibleGroup.getBounds().pad(0.05);

    map.fitBounds(bounds, { animate: false });

    var currentZoom = map.getBoundsZoom(bounds, false);
    map.setMinZoom(currentZoom);

    if (map.getZoom() < currentZoom) {
        map.setZoom(currentZoom);
    }

    setTimeout(() => {
        map.invalidateSize();
        map.fitBounds(bounds, { animate: false });
        }, 100);
    }

    setTimeout(() => {
        updateMapBounds(markers);
    }, 100);

    var soundSystems = document.querySelectorAll('#sound-systems li');
    var yearFilters = document.querySelectorAll('#year-filters li');

    function updateFilters() {
        var activeSystemLi = document.querySelector('#sound-systems .active');
        var selectedSystem = activeSystemLi.getAttribute('data-system');
        var displaySystem = activeSystemLi.textContent.trim().replace(/\(\d+\)$/, '').trim();
        var systemImg = '';
        if (selectedSystem !== 'all') {
            var logoSrc = activeSystemLi.querySelector('img').src;
            systemImg = `<img src="${logoSrc}" style="width: 20px; height: 20px; margin-right: 5px; border-radius: 50%; vertical-align: middle;">`;
        }
        document.getElementById('selected-system').innerHTML = systemImg + displaySystem;

        var activeYearLi = document.querySelector('#year-filters .active');
        var selectedYear = activeYearLi.getAttribute('data-year');
        var displayYear = activeYearLi.textContent.trim().replace(/\(\d+\)$/, '').trim();
        document.getElementById('selected-year').textContent = displayYear;

        markerGroup.clearLayers();
        var visibleMarkers = markers.filter(function(marker) {
            var matchesSystem = selectedSystem === 'all' || marker.options.systems.includes(selectedSystem);
            var matchesYear = selectedYear === 'all' || marker.options.year === selectedYear || (selectedYear === "1990s" && marker.options.year === "1990s");
            if (matchesSystem && matchesYear) {
                markerGroup.addLayer(marker);
                return true;
            }
            return false;
        });
        updateMapBounds(visibleMarkers);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const initialSystems = ['all', 'Spiral Tribe', 'DiY', 'Circus Warp', 'Free Party People', 'Sweat', 'Circus Normal', 'Street Level' ];
        const ul = document.getElementById('sound-systems');
        const allLis = Array.from(ul.querySelectorAll('li'));
        let extraContainer = document.createElement('div');
        extraContainer.id = 'extra-systems';
        extraContainer.className = 'extra-container';
        extraContainer.style.maxHeight = '0px';
        let moreLi = document.createElement('li');
        moreLi.className = 'more-toggle';
        moreLi.innerHTML = `<img src="flower.png" alt="More Icon" style="width:30px;height:30px;margin-right:8px;border-radius:15px;"> <span class="more-text">MORE (65)...</span> <button class="toggle-btn more-toggle-btn collapsed">â–¶</button>`;
        const sweatLi = allLis.find(li => li.getAttribute('data-system') === 'Street Level');
        const nonInitial = allLis.filter(li => {
            const sys = li.getAttribute('data-system');
            return sys && !initialSystems.includes(sys);
        });
        nonInitial.forEach(li => extraContainer.appendChild(li));
        if (sweatLi && sweatLi.parentNode) {
            sweatLi.parentNode.insertBefore(extraContainer, sweatLi.nextSibling);
        }
        ul.insertBefore(moreLi, extraContainer);

        document.addEventListener('click', (e) => {
            const moreLink = e.target.closest('.more-toggle');
            if (moreLink) {
                const isExpanded = extraContainer.style.maxHeight !== '0px' && extraContainer.style.maxHeight !== '0';
                if (!isExpanded) {
                    if (ul.classList.contains('collapsed')) {
                        ul.classList.remove('collapsed');
                        const toggleBtn = document.querySelector('button[data-target="sound-systems"]');
                        if (toggleBtn) {
                            toggleBtn.classList.remove('collapsed');
                            toggleBtn.textContent = 'â–¼';
                        }
                        updateActiveVisibility();
                    }
                    const scrollHeight = extraContainer.scrollHeight;
                    extraContainer.style.maxHeight = scrollHeight + 'px';
                    moreLi.querySelector('.more-text').textContent = 'SHOW LESS';
                    const moreToggleBtn = moreLi.querySelector('.more-toggle-btn');
                    moreToggleBtn.textContent = 'â–¼';
                    moreToggleBtn.classList.remove('collapsed');
                    ul.appendChild(moreLi);
                } else {
                    extraContainer.style.maxHeight = '0px';
                    moreLi.querySelector('.more-text').textContent = 'MORE (65)...';
                    const moreToggleBtn = moreLi.querySelector('.more-toggle-btn');
                    moreToggleBtn.textContent = 'â–¶';
                    moreToggleBtn.classList.add('collapsed');
                    const onTransitionEnd = () => {
                        ul.insertBefore(moreLi, extraContainer);
                        extraContainer.removeEventListener('transitionend', onTransitionEnd);
                    };
                    extraContainer.addEventListener('transitionend', onTransitionEnd);
                }
            }
        });

        soundSystems.forEach(function(item) {
            item.addEventListener('click', function() {
            soundSystems.forEach(function(el) { el.classList.remove('active'); });
            this.classList.add('active');
            updateFilters();
            updateActiveVisibility();
            if (window.innerWidth <= 768) {
                document.querySelector('.sidebar').classList.remove('open');
                document.getElementById('sidebar-overlay').classList.remove('active');
                map.invalidateSize();
            }
        });
    });

     yearFilters.forEach(function(item) {
        item.addEventListener('click', function() {
            yearFilters.forEach(function(el) { el.classList.remove('active'); });
            this.classList.add('active');
            updateFilters();
            updateActiveVisibility();
            if (window.innerWidth <= 768) {
                document.querySelector('.sidebar').classList.remove('open');
                document.getElementById('sidebar-overlay').classList.remove('active');
                map.invalidateSize();
            }
        });
    });

     document.querySelectorAll('.toggle-btn').forEach(button => {
         button.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            const targetList = document.getElementById(targetId);
            const isCollapsed = targetList.classList.toggle('collapsed');
            this.classList.toggle('collapsed', isCollapsed);
            this.textContent = isCollapsed ? 'â–¶' : 'â–¼';
            if (targetId === 'sound-systems' && isCollapsed) {
                const extraCont = document.getElementById('extra-systems');
                const moreL = document.querySelector('.more-toggle');
                if (extraCont && extraCont.style.maxHeight !== '0px' && extraCont.style.maxHeight !== '0' && moreL) {
                    extraCont.style.maxHeight = '0px';
                    moreL.querySelector('.more-text').textContent = 'MORE (65)...';
                    const moreToggleBtn = moreL.querySelector('.more-toggle-btn');
                    moreToggleBtn.textContent = 'â–¶';
                    moreToggleBtn.classList.add('collapsed');
                    const onTE = () => {
                        ul.insertBefore(moreL, extraCont);
                        extraCont.removeEventListener('transitionend', onTE);
                    };
                    extraCont.addEventListener('transitionend', onTE);
                }
            }
            updateActiveVisibility();
        });
    });

    const menuToggle = document.querySelector('.menu-toggle');
    const closeBtn = document.querySelector('.close-btn');
    const sidebar = document.querySelector('.sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');

    menuToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        sidebar.classList.toggle('open');
        if (sidebarOverlay) sidebarOverlay.classList.toggle('active');
            map.invalidateSize();
    });

    closeBtn.addEventListener('click', () => {
        sidebar.classList.remove('open');
        if (sidebarOverlay) sidebarOverlay.classList.remove('active');
            map.invalidateSize();
    });

    document.addEventListener('click', function(e) {
        if (sidebar.classList.contains('open') && !sidebar.contains(e.target)) {
            sidebar.classList.remove('open');
        if (sidebarOverlay) sidebarOverlay.classList.remove('active');
            map.invalidateSize();
        }
    });

    function updateActiveVisibility() {
        ['sound-systems', 'year-filters'].forEach(id => {
            const list = document.getElementById(id);
            if (list.classList.contains('collapsed')) {
                const activeItem = list.querySelector('li.active');
                list.querySelectorAll('li').forEach(item => {
                    item.style.display = item === activeItem ? 'flex' : 'none';
                });
            } else {
                list.querySelectorAll('li').forEach(item => {
                    item.style.display = 'flex';
                });
            }
        });
    }

    updateActiveVisibility();

    updateFilters();

    setTimeout(() => {
        updateSidebarPosition();
    }, 100);
    });
</script>

<div id="welcome-modal-overlay" class="modal-overlay"></div>
<div id="welcome-modal" class="modal">
    <div class="modal-content">
        <button class="modal-close-x">&times;</button>
        <!--<h1 class="modal-title">UK FREE PARTIES 1988-94</h1>-->
        <img src="welcome.png" alt="Welcome Background" class="modal-image"><br>
        <button id="close-modal-btn" class="modal-close-btn">EXPLORE THE FREE PARTY SCENE OF 1988-94</button>
    </div>
</div>

<div id="welcome-modal-2-overlay" class="modal-overlay"></div>
<div id="welcome-modal-2" class="modal welcome-modal">
    <div class="modal-content welcome-content">
        <button class="modal-close-x">&times;</button>
        <h1 class="modal-title">INTRODUCTION</h1>

        <a href="intropic1.png" class="welcome-thumb-link">
            <img src="intropic1.png" alt="party pic" class="welcome-thumb">
        </a>

        <div class="welcome-text">
            <div class="section-header">
                <img src="placemark.png" alt="Books" class="section-icon">
                <p>Background</p>
            </div>
            <p>
                In the early 1990s, the UK was electrified by an underground revolution â€” the free party scene. A coming together of tribes - travellers, city-living ravers, 
                squatters, activists, artists and musicians, these illegal, open-air gatherings united cultures with a shared sound and purpose on common land, fields, warehouses and abandoned quarries across the country. 
            </p>
            <p>
                Powered by DIY rigs, pirate radio signals, and word-of-mouth, crews like Spiral Tribe, DiY, Circus Warp, and many, many more turned empty spaces into pulsing dancefloors. No tickets. No security. Just music, freedom, and community â€” often lasting days.
            </p>
            <p>
                At the time we just wanted to party, but these werenâ€™t just parties â€” the hedonism became resistance. Against commercial clubs. Against police crackdowns. Against the looming Criminal Justice and Public Order Act of 1994, which targeted â€œrepetitive beatsâ€ and small gatherings of people. Castlemorton in 1992 â€” with 25-40k attendees â€” became the final straw that ignited the bill.
            </p>
            <p>
                This map is an archive of an era that could only have happened when it did. Every marker tells hundreds or thousands of stories and adventures: a convoy evading roadblocks, a generator humming under moonlight, a revelatory experience, a sunrise over a crowd in collective euphoria... Explore the map, step back in time and remember. As the nights got longer, the vibe got stronger.
            </p>
            <a href="intropic2.png" class="welcome-thumb-link welcome-thumb-link-left">
                <img src="intropic2.png" alt="party pic" class="welcome-thumb">
            </a>
            <div class="section-header">
                <img src="placemark.png" alt="Books" class="section-icon">
                <p>Credits</p>
            </div>
            <p>
                The page was designed and made by BXL909. The map will almost certainly remain incomplete. Many of my own memories of the time are hazy and have blurred into one, often unable to distinguish one party from another. I was usually the driver, often with no clue where we'd end up. We didn't have GPS, mobile phones, etc, and we certainly didn't keep records of our exploits. All my press cuttings and flyers are sadly long gone, so I simply could not have made this without the incredible <a target="_blank" href="https://freepartypeople.wordpress.com/">freepartypeople blog</a>. I used it to compile dates and work out which sound systems were where. I've no wish to reproduce the great work that's already been done there - I strongly encourage clicking through to their entry for each party, because you'll find lots more information and often some photos, flyers, even video, and some of the discussion there is very entertaining too! Other than that, credit to everyone else who was there and made the scene all that it was.
            </p>
        </div>
        <div class="clear-float"></div> 
        <button class="modal-close-btn close-modal" data-target="welcome-modal-2">CLOSE</button>
    </div>
</div>

<div id="links-modal-overlay" class="modal-overlay"></div>
<div id="links-modal" class="modal links-modal">
    <div class="modal-content links-content">
        <button class="modal-close-x">&times;</button>
        <h1 class="modal-title">LINKS</h1>

        <div class="section-header">
            <img src="placemark.png" alt="More information" class="section-icon">
            <p>More information</p>
        </div>
        <div class="links-list">
            <div class="link-item">
                <a href="https://freepartypeople.wordpress.com/" target="_blank">Free Party People Blog</a>
                <p class="link-desc">Primary source of UK free party history with detailed event posts with often informative, entertaining and blurred memories added by the community. This website was invaluable in producing the map, and all events featured on the map include a link to this website, which offers much more detail than this site tries to provide.</p>
            </div>
            <div class="link-item">
                <a href="https://www.ukrockfestivals.com/" target="_blank">UK Rock Festivals</a>
                <p class="link-desc">Archive of free festivals from the 70sâ€“90s, including sound system events.</p>
            </div>
            <div class="link-item">
                <a href="https://www.alanlodge.co.uk/" target="_blank">Alan Lodge Photography</a>
                <p class="link-desc">An amazing archive of photography from Alan Lodge taken over 40+ years documenting alternative lifestyles and sub-cultures.</p>
            </div>
        </div>

        <!-- Books -->
        <div class="section-header">
            <img src="placemark.png" alt="Books" class="section-icon">
            <p>Books</p>
        </div>
        <div class="links-list">
            <div class="link-item">
                <a href="https://velocitypress.uk/product/dreaming-in-yellow-book/" target="_blank">Dreaming in Yellow: The story of the DiY sound system</a>
                <p class="link-desc">by Harry Harrison.</p>
            </div>
            <div class="link-item">
                <a href="https://velocitypress.uk/product/a-darker-electricity/" target="_blank">A Darker Electricty: The origins of the Spiral Tribe sound system</a>
                <p class="link-desc">by Mark Angelo Harison.</p>
            </div>
            <div class="link-item">
                <a href="https://georgemckay.org/reviews/senseless-acts-of-beauty/" target="_blank">Senseless Acts of Beauty</a>
                <p class="link-desc">by George McKay.</p>
            </div>
            <div class="link-item">
                <a href="https://mitpress.mit.edu/9781917674089/fierce-dancing/" target="_blank">Fierce Dancing</a>
                <p class="link-desc">by C.J. Stone.</p>
            </div>
            <div class="link-item">
                <a href="https://serpentstail.com/work/altered-state/" target="_blank">Altered State</a>
                <p class="link-desc">by Matthew Collin.</p>
            </div>
        </div>

        <!-- Video -->
        <div class="section-header">
            <img src="placemark.png" alt="Video" class="section-icon">
            <p>Video</p>
        </div>
        <div class="links-list">
            <div class="link-item">
                <a href="https://freepartydoc.info/" target="_blank">Free Party: A Folk History</a>
                <p class="link-desc">The excellent documentary from Aaron Trinder. Loads of archive footage charting the beginnings to the aftermath.</p>
            </div>
            <div class="link-item">
                <a href="https://www.youtube.com/watch?v=FZRVQz7H73E" target="_blank">DiY</a>
                <p class="link-desc">A short piece on the DiY sound system.</p>
            </div>
            <div class="link-item">
                <a href="https://www.youtube.com/watch?v=0XYUQdMUkmg" target="_blank">World In Action</a>
                <p class="link-desc">Smeatharpe and the subsequent difficulties faced by the convoy.</p>
            </div>
            <div class="link-item">
                <a href="https://www.youtube.com/watch?v=E8XxQAotVmc" target="_blank">Roaming Free</a>
                <p class="link-desc">Documentary on new age travellers with a brief bit about Castlemorton.</p>
            </div>
        </div>

        <!-- Podcasts -->
        <div class="section-header">
            <img src="placemark.png" alt="Podcasts" class="section-icon">
            <p>Podcasts</p>
        </div>
        <div class="links-list">
            <div class="link-item">
                <a href="https://talesfromadisappearingcity.buzzsprout.com/2154626/episodes/17287428-episode-30-free-party-a-folk-history-spiral-tribe-bedlam-diy-and-other-underground-tales-special-guest-aaron-trinder" target="_blank">Tales from a Disappearaing City</a>
                <p class="link-desc">A lengthy in-depth interview with Aaaron Trinder, maker of the Free Party: A Folk History documentary.</p>
            </div>
            <div class="link-item">
                <a href="https://bureauoflostculture.podbean.com/e/the-adventures-of-the-spiral-tribe/" target="_blank">Bureau of Lost Culture</a>
                <p class="link-desc">In interview with Mark Angelo Harrison, Spiral Tribe.</p>
            </div>
            <div class="link-item">
                <a href="https://sonicfields.buzzsprout.com/2368028/episodes" target="_blank">Sonic Fields</a>
                <p class="link-desc">A superb series giving the history of free festivals with lots of really good interviews.</p>
            </div>
        </div>

        
        <!-- Sound systems -->
        <div class="section-header">
            <img src="placemark.png" alt="Sound systems" class="section-icon">
            <p>Sound systems</p>
        </div>
        <div class="links-list">
            <div class="link-item">
                <a href="https://sp23.org/" target="_blank">Spiral Tribe</a>
                <p class="link-desc">Make some fuckin noise!</p>
            </div>
        </div>
        <button class="modal-close-btn close-modal" data-target="links-modal">CLOSE</button>
    </div>
</div>

<div id="party-modal-overlay" class="modal-overlay"></div>
<div id="party-modal" class="modal party-modal">
    <div class="modal-content party-content">
        <button class="modal-close-x">&times;</button>
        <h1 class="modal-title" id="party-title"></h1>
        <div id="party-upper" class="party-upper">
            <div id="party-systems"></div>
            <div id="party-links"></div>
        </div>
        <div id="party-notes"></div>
        <button class="modal-close-btn close-modal" data-target="party-modal">CLOSE</button>
    </div>
</div>

<style>
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.60);
        backdrop-filter: blur(5px);
        z-index: 20000;
        opacity: 0;
        transition: opacity 0.4s ease;
        pointer-events: none; 
    }

    .modal-overlay.active {
        display: block;
        opacity: 1;
        pointer-events: auto; 
    }

    .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: auto;
        max-width: 750px !important;
        font-family: 'Space Mono', sans-serif;
        background: rgba(20, 20, 30, 0.95);
        border: 1px solid #666;
        border-radius: 7px;
        padding: 20px;
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.4);
        z-index: 20001;
        text-align: center;
        opacity: 0;
        transition: all 0.4s ease;
        backdrop-filter: blur(10px);
        pointer-events: none;
    }

    .modal.active {
        display: block;
        opacity: 1;
        pointer-events: auto;
    }

    .modal-content {
        font-size: 0.8em;
        color: #ccc;
        font-family: 'Space Mono', sans-serif;
    }


    .modal-title {
        margin: 0;
        margin-bottom: 20px;
        font-family: 'Slackey', sans-serif;
        -webkit-text-stroke: 0.5px #fff;
        font-weight: 400;
        font-size: 2.6em;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0px;
        z-index: 10001;
    }

    .party-modal .modal-title {
        font-size: 1.6em;
    }

    .modal-image {
        max-width: 700px;
        object-fit: cover;
        border-radius: 7px;
        margin-bottom: 16px;
        border: 1px solid #666;
        margin-top: 10px;
    }

    .modal-close-btn {
        margin-top: 10px;
        background: #666;
        color: #fff;
        border: none;
        padding: 6px 16px;
        font-family: 'Space Mono', sans-serif;
        font-weight: 700;
        font-size: 1.1em;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-radius: 7px;
        cursor: pointer;
        width: 100%;
    }

    .modal-close-btn:hover {
        color: #000;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.8);
        background: linear-gradient(45deg, #666, #ccc);
    }

    .modal-close-x {
        position: absolute;
        top: 5px;
        right: 5px;
        background: none;
        border: none;
        color: #ccc;
        font-size: 1.5em;
        cursor: pointer;
        font-family: 'Space Mono', sans-serif;
        z-index: 99999999;
        transition: color 0.3s ease;
    }

    .modal-close-x:hover {
        color: #fff;
    }

    #welcome-modal-2 > div > div.welcome-text > div > p
    {
        margin-bottom: 0px;
    }

    @keyframes flicker {
        0% { opacity: 0.9; text-shadow: 0 0 10px rgba(0, 255, 204, 0.6); }
        100% { opacity: 1; text-shadow: 0 0 20px rgba(0, 255, 204, 0.9); }
    }

    @media (max-width: 768px) {
        .modal {
            width: 80% ;
            max-width: 80% !important;
            max-height: 85vh;
            padding: 20px;
        }
        .modal-close-btn {
        font-size: 0.9em !important;
        }
        .modal-title {
            font-size: 1.6em !important;
            letter-spacing: 0px;
        }
        .modal-image {
            width: calc(100% - 20px);
            height: auto;
            max-width: none;
            margin: 0 10px 16px;
            object-fit: contain;
        }
    }

    #about-links li.about-link {
        padding: 2px 8px;
        cursor: pointer;
        color: #ccc;
        font-size: 0.8em;
        display: flex;
        align-items: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        font-family: 'Space Mono', sans-serif;
        margin-bottom: 4px;
    }

    #about-links li.about-link img {
        width: 30px;
        height: 30px;
        margin-right: 8px;
        border-radius: 15px;
        transition: transform 0.5s ease;
    }

    #about-links li.about-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    #about-links li.about-link:hover img {
        animation: singleRotate 0.5s ease-in-out;
    }

    #about-links li.about-link.active {
        background: rgba(255, 255, 255, 0.15);
    }

    .links-modal {
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    .links-content {
        display: flex;
        flex-direction: column;
        height: 100%;
        text-align: left;
        padding: 10px 0;
    }

    .links-list {
        flex: 1;
        overflow-y: auto;
        padding: 0 15px;
        margin: 5px 0;
        font-size: 0.85em;
        line-height: 1.6;
    }

    .link-item {
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 1px dashed rgba(255, 255, 255, 0.15);
        transition: all 0.3s ease;
    }

    .link-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .link-item a {
        color: #ff8a00;
        text-decoration: none;
        font-weight: 700;
        font-size: 1.2em ;
        display: inline-block;
        margin-bottom: 4px;
        transition: color 0.3s ease;
    }

    .link-item a:hover {
        color: #fff;
    }

    .link-desc {
        color: #ccc;
        margin: 0;
        font-size: 1.2em;
        line-height: 1.5;
    }

    .section-header {
        display: flex;
        align-items: center;
        margin: 12px 15px 8px 0px;
        font-weight: 700;
        color: #ccc;
        font-size: 1.3em;
        text-transform: uppercase;
        letter-spacing: 0px;
        background-color: rgba(255, 255, 255, 0.1);
    }

    .section-header p {
        margin: 0;
        font-family: 'Space Mono', sans-serif;
    }

    .section-icon {
        width: 18px;
        height: 18px;
        margin-right: 10px;
    }

    .section-header:hover .section-icon {
        animation: singleRotate 0.5s ease-in-out;
    }

    .links-list::-webkit-scrollbar {
        width: 8px;
    }

    .links-list::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 4px;
    }

    .links-list::-webkit-scrollbar-thumb {
        background: #666;
        border-radius: 4px;
    }

    .links-list::-webkit-scrollbar-thumb:hover {
        background: #999;
    }

    @media (max-width: 768px) {
        .links-modal {
            width: 90%;
            max-height: 85vh;
        }
    }

    @media (max-width: 480px) {
        .sidebar li img {
            width: 25px;
            height: 25px;
        }
    }

    .welcome-modal {
        max-width: 800px;
        width: 90%;
        max-height: 85vh;
        overflow-y: auto; 
        display: block;
        text-align: left;
    }

    .welcome-content {
        display: block; 
        padding: 10px 0;
        min-height: 100%;
    }

    .welcome-thumb-link {
        float: right; 
        width: 180px !important;
        height: 180px !important;
        margin: 0 0 15px 20px; 
        border: 1px solid #666;
        border-radius: 7px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,.5);
        transition: all .3s ease;
        cursor: pointer;
        display: block;
        text-decoration: none;
        line-height: 0;
        position: relative;
        z-index: 1000; 
    }

    .welcome-thumb-link-left {
        float: left; 
        width: 180px !important;
        height: 180px !important;
        margin: 0 20px 15px 0; 
        border: 1px solid #666;
        border-radius: 7px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,.5);
        transition: all .3s ease;
        cursor: pointer;
        display: block;
        text-decoration: none;
        line-height: 0;
        position: relative; 
        z-index: 1000; 
    }

    .welcome-thumb-link:hover, .welcome-thumb-link-left:hover {
        border-color: #ff8a00;
    }

    .welcome-thumb {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .welcome-text {
        margin: 0;
        padding: 0 20px 0 20px; 
        font-size: 1.05em;
        line-height: 1.75;
        color: #ddd;
        text-align: justify;
        hyphens: auto;
        position: relative;
        z-index: 0; 
        overflow: visible;
    }

    .welcome-text p {
        margin: 0 0 16px 0;
    }

    .clear-float {
        clear: both;
    }

    @media (max-width: 768px) {
        .welcome-thumb-link, .welcome-thumb-link-left {
            float: none;
            margin: 0 auto 20px; 
            width: 140px;
            height: 140px;
        }

        .welcome-text {
            padding: 0 15px;
        }
    }

    #lightbox-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        z-index: 30000;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    #lightbox-overlay.active {
        display: flex;
        opacity: 1;
    }

    #lightbox-image {
        max-width: 90%;
        max-height: 90%;
        border: 1px solid #666;
        border-radius: 7px;
        animation: lightboxPop 0.4s ease-out;
    }

    #lightbox-close {
        position: absolute;
        top: 20px;
        right: 30px;
        background: none;
        border: none;
        color: #fff;
        font-size: 2.5em;
        cursor: pointer;
        text-shadow: 0 0 10px #000;
        transition: transform 0.2s ease;
    }

    #lightbox-close:hover {
        transform: scale(1.2);
    }

    @keyframes lightboxPop {
        0% { transform: scale(0.7); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
    }

    @media (max-width: 768px) {
        .welcome-thumb-link, .welcome-thumb-link-left {
            position: static;
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            float: none;
        }
        .welcome-text {
            margin-right: 0;
            margin-top: 10px;
            padding: 0 15px;
        }
        .welcome-text p {
            font-size: 0.95em;
        }
    }

    .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
        z-index: 10001;
        opacity: 0;
        transition: opacity 0.4s ease;
        pointer-events: none;
    }

    .sidebar-overlay.active {
        display: block;
        opacity: 1;
        pointer-events: auto;
    }

    .party-modal {
        max-width: 400px !important;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        text-align: left;
    }

    .party-content {
        display: flex;
        flex-direction: column;
        height: 100%;
        padding: 10px 0;
    }

    .party-upper {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }

    #party-systems, #party-links {
        flex: 1;
        color: #ccc;
        font-size: 0.9em;
        line-height: 1.6;
        margin-bottom: 0;
    }

    #party-notes {
        margin-bottom: 15px;
        color: #ccc;
        font-size: 0.9em;
        line-height: 1.6;
        width: 100%;
    }

    #party-links a {
        color: #ff8a00;
        text-decoration: none;
        transition: color 0.3s;
    }

    #party-links a:hover {
        color: #fff;
    }

    .party-modal::-webkit-scrollbar {
        width: 8px;
    }

    .party-modal::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 4px;
    }

    .party-modal::-webkit-scrollbar-thumb {
        background: #666;
        border-radius: 4px;
    }

    .party-modal::-webkit-scrollbar-thumb:hover {
        background: #999;
    }

    @media (max-width: 768px) {
        .party-modal {
            width: 80% !important;
            max-width: 80% !important;
            max-height: 85vh;
        }
        .party-upper {
            flex-direction: row;
            gap: 10px;
        }
        #party-systems, #party-links {
            font-size: 0.8em;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('welcome-modal');
        const overlay = document.getElementById('welcome-modal-overlay');
        const closeBtn = document.getElementById('close-modal-btn');

        setTimeout(() => {
            modal.classList.add('active');
            overlay.classList.add('active');
        }, 300); 

        const closeModal = () => {
            modal.classList.remove('active');
            overlay.classList.remove('active');
        };

        closeBtn.addEventListener('click', closeModal);
        overlay.addEventListener('click', closeModal);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                closeModal();
            }
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.about-link').forEach(link => {
            link.addEventListener('click', () => {
                const modalId = link.getAttribute('data-modal');
                const modal = document.getElementById(modalId);
                const overlay = document.getElementById(modalId + '-overlay');

                modal.classList.add('active');
                overlay.classList.add('active');
            });
        });

        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                const target = btn.getAttribute('data-target');
                const modal = document.getElementById(target);
                const overlay = document.getElementById(target + '-overlay');
                modal.classList.remove('active');
                overlay.classList.remove('active');
            });
        });

        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', () => {
                const modalId = overlay.id.replace('-overlay', '');
                const modal = document.getElementById(modalId);
                modal.classList.remove('active');
                overlay.classList.remove('active');
            });
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                modal.classList.remove('active');
                const overlay = document.getElementById(modal.id + '-overlay');
                if (overlay) overlay.classList.remove('active');
                });
            }
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const lightbox = document.getElementById('lightbox-overlay');
        const lightboxImg = document.getElementById('lightbox-image');
        const lightboxClose = document.getElementById('lightbox-close');
        const triggers = document.querySelectorAll('.welcome-thumb-link, .welcome-thumb-link-left');

        triggers.forEach(trigger => {
            trigger.addEventListener('click', (e) => {
                if (window.innerWidth <= 768) {
                    window.open(trigger.href, '_blank');
                    return;
                }
                e.preventDefault();
                lightboxImg.src = trigger.href;
                lightbox.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
        });

        const closeLightbox = () => {
            lightbox.classList.remove('active');
            setTimeout(() => {
                lightboxImg.src = '';
                document.body.style.overflow = '';
            }, 400);
        };

        lightboxClose?.addEventListener('click', closeLightbox);
        lightbox?.addEventListener('click', (e) => {
            if (e.target === lightbox) closeLightbox();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && lightbox.classList.contains('active')) {
                closeLightbox();
            }
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.modal-close-x').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const modal = btn.closest('.modal');
                const overlay = document.getElementById(modal.id + '-overlay');
                if (modal && overlay) {
                    modal.classList.remove('active');
                    overlay.classList.remove('active');
                }
            });
        });
    });
</script>
<div id="lightbox-overlay">
    <button id="lightbox-close">Ã—</button>
    <img id="lightbox-image" src="" alt="Full size image">
</div>
</body>

</html>




